import{d as e,r as a,o as l,B as t,c as o,e as s,a0 as u,w as i,k as n,a4 as r,l as m,a1 as p,g as d,t as v,aA as c,Y as f,aI as y,a2 as g,a3 as _}from"./index.9PHSMUIB.js";import{E as k}from"./el-card.DWbysKpS.js";import{E as j,a as w,b as C}from"./el-table-column.haX2jq5s.js";import{E as h}from"./el-tag.CLWce1kX.js";import"./el-select.dUFpYm6H.js";import"./el-scrollbar.DlPh6Z7D.js";import"./el-popper.e9kr8u9Q.js";import"./el-tooltip.l0sNRNKZ.js";import{E as x}from"./el-dialog.Dis4ipFy.js";import{g as b,A as V,U as z,D,E as I,a as E}from"./node.B7CBv-vw.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./isEqual.DDyRMzJ4.js";import"./_initCloneObject.cf8iq1wq.js";import"./debounce.i1DMUZzi.js";import"./index.D7zGuEZp.js";import"./strings.CQ_np2th.js";import"./castArray.BN0gQOTw.js";import"./index.D6nSmJHY.js";import"./isUndefined.DgmxjSXK.js";import"./use-dialog.CybRpRek.js";import"./refs.CNClepWF.js";const B={class:"dialog-footer"},N=U(e({__name:"nodes",setup(e){const U=a([]),N=a(""),S=a(""),A=a(""),O=a(""),T=a(!1),K=a(),L=a(""),R=a("1");async function H(){const{data:e}=await b();U.value=e}l((async()=>{H()}));const q=()=>{L.value="添加节点",N.value="",A.value="",R.value="1",T.value=!0},F=async()=>{let e=N.value.split(/[\r\n,]/);if(e=e.map((e=>e.trim())).filter((e=>""!==e)),"添加节点"==L.value){if("1"===R.value){if(""===A.value.trim())return void c.error("备注不能为空");e&&(N.value=e.join(","),await V({link:N.value.trim(),name:A.value.trim()}))}else for(let a=0;a<e.length;a++)await V({link:e[a],name:""});c.success("添加成功")}else await z({oldname:O.value.trim(),oldlink:S.value.trim(),link:N.value.trim(),name:A.value.trim()}),c.success("更新成功");H(),N.value="",A.value="",T.value=!1},G=a([]),J=e=>{G.value=e},Q=()=>{0!==G.value.length&&y.confirm("你是否要删除选中这些 ?","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((()=>{for(let e=0;e<G.value.length;e++)D({id:G.value[e].ID}),U.value=U.value.filter((a=>a.ID!==G.value[e].ID));c({type:"success",message:"删除成功"})}))},Y=a(1),$=a(10),M=e=>{$.value=e},P=e=>{Y.value=e},W=t((()=>{const e=(Y.value-1)*$.value,a=e+$.value;return U.value.slice(e,a)})),X=e=>{(e=>{const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select();try{const e=document.execCommand("copy");c({type:e?"success":"warning",message:e?"复制成功！":"复制失败！"})}catch(l){c({type:"warning",message:"复制失败！"})}finally{document.body.removeChild(a)}})(e.Link)};return(e,a)=>{const l=g,t=I,b=E,V=_,z=x,G=j,Z=h,ee=w,ae=C,le=k;return o(),s("div",null,[u(z,{modelValue:T.value,"onUpdate:modelValue":a[4]||(a[4]=e=>T.value=e),title:L.value,width:"80%"},{footer:i((()=>[n("div",B,[u(V,{onClick:a[3]||(a[3]=e=>T.value=!1)},{default:i((()=>a[9]||(a[9]=[r("关闭")]))),_:1}),u(V,{type:"primary",onClick:F},{default:i((()=>a[10]||(a[10]=[r("确定")]))),_:1})])])),default:i((()=>[u(l,{modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),placeholder:"请输入节点多行使用回车或逗号分开,支持base64格式的url订阅",type:"textarea",style:{"margin-bottom":"10px"},autosize:{minRows:2,maxRows:10}},null,8,["modelValue"]),"添加节点"==L.value?(o(),m(b,{key:0,modelValue:R.value,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value=e),class:"ml-4"},{default:i((()=>[u(t,{value:"1",size:"large"},{default:i((()=>a[7]||(a[7]=[r("合并")]))),_:1}),u(t,{value:"2",size:"large"},{default:i((()=>a[8]||(a[8]=[r("分开")]))),_:1})])),_:1},8,["modelValue"])):p("",!0),"2"!=R.value?(o(),m(l,{key:1,modelValue:A.value,"onUpdate:modelValue":a[2]||(a[2]=e=>A.value=e),placeholder:"请输入备注"},null,8,["modelValue"])):p("",!0)])),_:1},8,["modelValue","title"]),u(le,null,{default:i((()=>[u(V,{type:"primary",onClick:q},{default:i((()=>a[11]||(a[11]=[r("添加节点")]))),_:1}),a[18]||(a[18]=n("div",{style:{"margin-bottom":"10px"}},null,-1)),u(ee,{ref_key:"table",ref:K,data:d(W),style:{width:"100%"},onSelectionChange:J},{default:i((()=>[u(G,{type:"selection",fixed:"",prop:"ID",label:"id"}),u(G,{prop:"Name",label:"备注"},{default:i((e=>[u(Z,{type:"success"},{default:i((()=>[r(v(e.row.Name),1)])),_:2},1024)])),_:1}),u(G,{prop:"Link",label:"节点",sortable:"","show-overflow-tooltip":!0}),u(G,{prop:"CreateDate",label:"创建时间",sortable:""}),u(G,{fixed:"right",label:"操作",width:"120"},{default:i((e=>[u(V,{link:"",type:"primary",size:"small",onClick:a=>X(e.row)},{default:i((()=>a[12]||(a[12]=[r("复制")]))),_:2},1032,["onClick"]),u(V,{link:"",type:"primary",size:"small",onClick:a=>(e=>{R.value="1";for(let a=0;a<U.value.length;a++)U.value[a].ID===e.ID&&(L.value="编辑节点",A.value=U.value[a].Name,O.value=A.value,N.value=U.value[a].Link,S.value=N.value,T.value=!0)})(e.row)},{default:i((()=>a[13]||(a[13]=[r("编辑")]))),_:2},1032,["onClick"]),u(V,{link:"",type:"primary",size:"small",onClick:a=>{return l=e.row,void y.confirm(`你是否要删除 ${l.Name} ?`,"提示",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await D({id:l.ID}),c({type:"success",message:"删除成功"}),H()}));var l}},{default:i((()=>a[14]||(a[14]=[r("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),a[19]||(a[19]=n("div",{style:{"margin-top":"20px"}},null,-1)),u(V,{type:"info",onClick:a[5]||(a[5]=e=>{f((()=>{U.value.forEach((e=>{K.value.toggleRowSelection(e,!0)}))}))})},{default:i((()=>a[15]||(a[15]=[r("全选")]))),_:1}),u(V,{type:"warning",onClick:a[6]||(a[6]=e=>{K.value.clearSelection()})},{default:i((()=>a[16]||(a[16]=[r("取消选择")]))),_:1}),u(V,{type:"danger",onClick:Q},{default:i((()=>a[17]||(a[17]=[r("批量删除")]))),_:1}),a[20]||(a[20]=n("div",{style:{"margin-top":"20px"}},null,-1)),u(ae,{onSizeChange:M,onCurrentChange:P,"current-page":Y.value,"page-size":$.value,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,30,40],total:U.value.length},null,8,["current-page","page-size","total"])])),_:1})])}}}),[["__scopeId","data-v-e6fb1451"]]);export{N as default};
